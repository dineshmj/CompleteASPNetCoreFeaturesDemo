@page "/customer-mgmt"
@rendermode InteractiveServer

@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>Customer Management</PageTitle>

<h3>Customer Management</h3>

<AuthorizeView>
    <Authorized Context="mainAuth">
        <div class="mt-3">

            <!-- Search Customer -->
            <AuthorizeView Roles="view_customer">
                <Authorized Context="viewAuth">
                    <button class="btn btn-primary me-2" @onclick="ShowSearch">
                        Search Customer
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="btn btn-primary me-2 btn-disabled" disabled>Search Customer</button>
                </NotAuthorized>
            </AuthorizeView>

            <!-- Create New Customer -->
            <AuthorizeView Roles="insert_customer">
                <Authorized Context="insertAuth">
                    <button class="btn btn-success" @onclick="ShowCreate">
                        Create New Customer
                    </button>
                </Authorized>
                <NotAuthorized>
                    <button class="btn btn-success btn-disabled" disabled>Create New Customer</button>
                </NotAuthorized>
            </AuthorizeView>

        </div>

        <div class="mt-4">
            @RenderCurrentView()            
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private string? CurrentView;

    private void ShowSearch ()
    {
        CurrentView = "search";
        StateHasChanged ();
    }

    private void ShowCreate () 
    {
        CurrentView = "create";
        StateHasChanged ();
    }

    private RenderFragment RenderCurrentView()
        => CurrentView switch
        {
            "search" => builder => { builder.OpenComponent(0, typeof(CustomerSearch)); builder.CloseComponent(); },
            "create" => builder => { builder.OpenComponent(0, typeof(CustomerCreate)); builder.CloseComponent(); },
            _ => builder => { }
        };
}